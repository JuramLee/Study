https://velog.io/@devjooj/React-React-Query-%EC%82%AC%EC%9A%A9-%EC%9D%B4%EC%9C%A0-Queries-%EA%B0%9C%EB%85%90%ED%8E%B8
https://velog.io/@tkdals0978/React-Query-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0
https://velog.io/@jhjung3/React-Query%EC%9D%98-useQueries-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0-79d6b6k1
https://velog.io/@kimhyo_0218/React-Query-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BF%BC%EB%A6%AC-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-useQuery

useInfiniteQuery()
https://velog.io/@familyman80/React-Query-%ED%95%9C%EA%B8%80-%EB%A9%94%EB%89%B4%EC%96%BC


ì›¹ í˜ì´ì§€ë¥¼ ë³´ë©´ í¼ì§í•œ ë ˆì´ì•„ì›ƒì„ ì œì™¸í•˜ê³ ëŠ” ì „ë¶€ ë°±ì—”ë“œë¡œë¶€í„° ë°›ì•„ì˜¤ëŠ” ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œí˜„í•˜ëŠ” ê²ƒì¼ ê±°ë‹¤.(ë¬¼ë¡  ê·¸ë ‡ì§€ ì•Šì€ ì›¹í˜ì´ì§€ë“¤ë„ ì¡´ì¬í•œë‹¤.) ê·¸ëŸ¼ ë°ì´í„°ëŠ” í•­ìƒ ë°±ì—”ë“œì—ê²Œ ë‹¤ì‹œ ìš”ì²­í•´ì•¼í• ê¹Œ? 

 

ì •ë‹µì€ NO !

ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬(Redux, Recoil, Mobx ë“±)ë¡œ ì¤‘ë³µë˜ëŠ” ë°ì´í„° ìš”ì²­ì— í•œí•´ì„œëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤(ì „ì—­ ìƒíƒœ ê´€ë¦¬ë¡œ props drillingë„ í”¼í•  ìˆ˜ ìˆë‹¤). ëª¨ë‘ í›Œë¥­í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì§€ë§Œ ë°±ì—”ë“œ ë°ì´í„°ë“¤ì„ ê´€ë¦¬í•˜ê¸°ì—ëŠ” ì í•©í•˜ì§€ ì•Šì€ ì ë“¤ì´ ìˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ìƒíƒœê´€ ë¦¬ë¥¼ íš¨ìœ¨ì ì´ê²Œ í•˜ë©´ì„œ ë™ì‹œì— ë°±ì—”ë“œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸°ì—ë„ ìš©ì´í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì—†ì„ê¹Œ?

React-queryë€?

React-queryëŠ” React Applicationì—ì„œ ë°ì´í„° ê´€ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ ë‘ë§ˆë¦¬ í† ë¼ë¥¼ ë‹¤ ì¡ê²Œ í•´ì£¼ëŠ” JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ì£¼ë¡œ ë°ì´í„° fetching(API í˜¸ì¶œ), ë°ì´í„° ìºì‹±, ë™ê¸°í™”, ì—…ë°ì´íŠ¸ ë“±ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. React-queryëŠ” ì„œë²„ì™€ì˜ ìƒí˜¸ì‘ìš©ì„ ì¶”ìƒí™”í•˜ê³  ë°ì´í„° ê´€ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.
 

ë‹¨ì ì¸ ì˜ˆë¡œ stateì™€ useEffectë¡œ ìš”ì²­í•˜ê³  ì €ì¥í•˜ë˜ ì½”ë“œë¥¼ ë‹¨ í•œì¤„ë¡œ ìš”ì•½í•  ìˆ˜ ìˆë‹¤.

const Example = async () => {
  const [data, setData] = useState();
  
  useEffect(() => {
    // data ìš”ì²­ ë¡œì§
    const res = await fetching...;
    setData(res);
  }, []);
  
  return ( ... );
}
const Example = async () => {
  const { data } = useQuery(['querykey'], fetching, option);
  
  return ( ... );
}
ìš”ì²­ì— ëŒ€í•œ res ë°ì´í„° ê°’ë§Œ ë‹´ê²¨ìˆëŠ”ê²Œ ì•„ë‹ˆë¼ isLoading, isError, isSuccess, isFetching ë“± ìš”ì²­ì— ëŒ€í•œ ìƒíƒœì— ê´€í•œ ì •ë³´ë„ í•¨ê»˜ ë¦¬í„´í•œë‹¤.

ëŒ€ë¶€ë¶„ì˜ ì†Œí”„íŠ¸ ì›¨ì–´ê°€ ê°€ì§€ê³  ìˆëŠ” ê¸°ë³¸ì ì¸ ë°ì´í„° ì²˜ë¦¬ ê¸°ëŠ¥ìœ¼ë¡œ Create(ìƒì„±), Read(ì¡°íšŒ), Update(ìˆ˜ì •), Delete(ì‚­ì œ)ì˜ ì•ê¸€ìë¥¼ ë”´ CRUDë¼ê³  í•˜ëŠ” ê°œë…ì´ ìˆë‹¤. React-queryì—ì„œëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒ(R)í•  ë•ŒëŠ” useQuery(), ë°ì´í„°ì— ëŒ€í•œ ìƒì„±, ìˆ˜ì •, ì‚­ì œ(CUD)ëŠ” useMutation()ì„ ì‚¬ìš©í•œë‹¤.

ğŸ’¡  QueryClient()ëŠ” ì¿¼ë¦¬ì™€ ì„œë²„ì˜ ë°ì´í„° ìºì‹œë¥¼ ê´€ë¦¬í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì´ë‹¤. React-queryê°€ í•„ìš”í•œ ìµœìƒë‹¨ì— QueryClientë¥¼ ì„ ì–¸í•´ì£¼ê³  QueryClientProviderë¡œ ê°ì‹¸ì¤˜ì•¼ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.
 

useQuery(['querykey'], fetching, option)

useQueryëŠ” ë°ì´í„° ì¡°íšŒì— ì‚¬ìš©ë˜ëŠ” í›…ì´ë‹¤.

1ï¸âƒ£ ì²«ë²ˆì§¸ ì¸ìë¡œëŠ” uniqueí•˜ê²Œ ê´€ë¦¬ë˜ì–´ì•¼í•  ê°’ì¸ queryKeyê°€ ì˜¨ë‹¤. ê°„ë‹¨í•œ ë¬¸ìì—´ì´ì–´ë„ ë˜ê³  ë°°ì—´ì— ë‹´ì•„ì™€ë„ ìƒê´€ ì—†ë‹¤. (ë¬¸ìì—´ë¡œ ì§€ì •í•´ë„ ì•Œì•„ì„œ ë°°ì—´ì˜ 0ë²ˆì§¸ index ê°’ìœ¼ë¡œ ì´í•´í•œë‹¤) ì—¬ëŸ¬ê°œë¥¼ ë‹´ì•„ë„ ë˜ê³  ë°°ì—´ì— ëŒ€í•´ì„œë§Œ ìˆœì„œê°€ ì¤‘ìš”í•˜ë‹¤. ì¦‰ í‚¤ê°’ìœ¼ë¡œ ê°ì²´ë¥¼ ë‹´ì•˜ëŠ”ë° ê·¸ ê°ì²´ ì•ˆì—ì„œì˜ ë°ì´í„° ìˆœì„œëŠ” ìƒê´€ì—†ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

2ï¸âƒ£ ë‘ë²ˆì§¸ ì¸ìë¡œëŠ” í•¨ìˆ˜ê°€ ë“¤ì–´ê°„ë‹¤. ì´ í•¨ìˆ˜ëŠ” dataë¥¼ ìš”ì²­í•˜ëŠ” fetching í•¨ìˆ˜ê°€ ì£¼ë¡œ ë“¤ì–´ê°€ë©° Promiseë¥¼ ë°˜í™˜í•œë‹¤. (í•´ë‹¹ PromiseëŠ” ì„±ê³µí•˜ë©´ res dataë¥¼, ì‹¤íŒ¨í•˜ë©´ errorë¥¼ ë°˜í™˜í•œë‹¤)

3ï¸âƒ£ ì„¸ë²ˆì§¸ ì¸ìë¡œëŠ” ë‹¤ì–‘í•œ optionë“¤ì´ ì˜¨ë‹¤. ê³µì‹ ë¬¸ì„œì— ë§ì€ ì˜µì…˜ë“¤ì„ ì˜ ì„¤ëª…í•´ ë’€ìœ¼ë‹ˆ ì˜µì…˜ ì „ì²´ëŠ” ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê³  ë§ì´ ì“°ì´ëŠ” ì˜µì…˜ë§Œ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ì.

useQuery option
â–¶ onSuccess ((data) => {})
    : fetching ì„±ê³µ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (dataëŠ” ì„±ê³µì‹œ res ê°’)
â–¶ onError ((error) => {})
    : fetching ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (errorëŠ” ì—ëŸ¬ ê°’)
â–¶ onSettled ((data | error) => {})
    : fetching ì„±ê³µí•´ì„œ ì„±ê³µí•œ ë°ì´í„°ê°€ ì „ë‹¬ë˜ê±°ë‚˜, ì‹¤íŒ¨í•´ì„œ ì—ëŸ¬ê°€ ì „ë‹¬ë  ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
â–¶ retry (boolean | number | (failureCount: number, error: TError) => boolean)
    : fetching ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ í•˜ëŠ” ì˜µì…˜. ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ 3ë²ˆ ì¬ì‹œë„ í•œë‹¤.
â–¶ staleTime (number | Infinity)
    : ìºì‹± ì¤‘ì¸ ë°ì´í„°ê°€ fresh ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ì‹œê°„. default staleTimeì€ 0ì´ë‹¤.
â–¶ cacheTime (number | Infinity)
    : ìºì‹±í•œ ë°ì´í„°ê°€ ë‚¨ì•„ìˆëŠ” ì‹œê°„. default cacheTimeì€ 5ë¶„ì´ë‹¤. (í•´ë‹¹ ì‹œê°„ì´ ì§€ë‚˜ë©´ ìºì‹± ë°ì´í„°ëŠ” ì§€ì›Œì§)
â–¶ refetchOnWindowFocus (boolean | 'always')
    : ë°ì´í„°ê°€ stale ìƒíƒœì¼ ë•Œ ìœˆë„ìš° ì°½ì´ ì„ íƒë  ë•Œë§ˆë‹¤ refetchí•˜ëŠ” ì˜µì…˜. default: true.
      (ê°™ì€ ì°½ì˜ ë‹¤ë¥¸ íƒ­ | ê°œë°œì ë„êµ¬ì°½ì—ì„œ ì›¹í˜ì´ì§€ë„ í•´ë‹¹)
 

ì—¬ëŸ¬ê°€ì§€ì˜ ìš”ì²­ì„ í•œë²ˆì— ìºì‹±í•  ìˆ˜ë„ ìˆëŠ”ë° ì´ë•ŒëŠ” useQueries()ë¥¼ ì‚¬ìš©í•œë‹¤. ì‰½ê²Œ ì„¤ëª…í•˜ìë©´ useQueryë¡œ ì´ë£¨ì–´ì§„ ë°°ì—´ë¡œì¨ useQuery í›…ì„ í†µí•´ ë°˜í™˜ë˜ëŠ” ì¿¼ë¦¬ ë°ì´í„°ê°€ ë°°ì—´ë¡œ ë°˜í™˜ëœë‹¤. useQueriesì— ëŒ€í•´ì„œëŠ” ë‹¤ìŒ ê²Œì‹œê¸€ì„ ì°¸ê³ í•˜ì.

const results = useQueries({
  queries: [
    { queryKey: ['post', 1], queryFn: fetchPost, staleTime: Infinity},
    { queryKey: ['post', 2], queryFn: fetchPost, staleTime: Infinity},
    ...
  ]
})
 

useMutation(() => {}, option)

useMutationì€ ë°ì´í„° ë³€ê²½ì— ì‚¬ìš©ë˜ëŠ” í›…ì´ë‹¤. ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³ , ë³€ê²½ëœ ë°ì´í„°ë¥¼ ì„œë²„ì— ë°˜ì˜í•œë‹¤. ë“±ë¡í•  ë• useMutation()ì´ê³  ì‚¬ìš©í•  ë• mutate() í˜¹ì€ mutateAsync() ì´ë‹¤. mutateëŠ” í•¨ìˆ˜ë¥¼ ë¦¬í„´í•˜ê³  mutateAsyncëŠ” Promiseë¥¼ ë¦¬í„´í•˜ë©° async/awaitê³¼ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

// 2ê°€ì§€ ë°©ë²• ëª¨ë‘ ê°€ëŠ¥
const { mutate } = useMutation((params) => { fetching(params)... }, {
  onSuccess: () => {
    ...
  },
  options
});

return <button onClick={() => mutate(params)}>ì˜ˆì‹œ</button>;

-------------------------------------------------------------------------

const myFunction = useMutation((params) => { fetching(params)... }, {
  onSuccess: () => {
    ...
  },
  options
});

return <button onClick={() => myFunction.mutate(params)}>ì˜ˆì‹œ</button>;
useMutation() ë˜í•œ useQuery()ì™€ ë™ì¼í•˜ê²Œ optionì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, ê³µì‹ ë¬¸ì„œì— ë§ì€ ì˜µì…˜ë“¤ì„ ì˜ ì„¤ëª…í•´ ë’€ìœ¼ë‹ˆ ì˜µì…˜ ì „ì²´ëŠ” ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê³  ë§ì´ ì“°ì´ëŠ” ì˜µì…˜ë§Œ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ì.

useMutation option
â–¶ onMutate: ((variables) => {})
    : mutation í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì‹¤í–‰ëœë‹¤. mutation í•¨ìˆ˜ì™€ ë™ì¼í•œ ë³€ìˆ˜ê°€ ì „ë‹¬ëœë‹¤.
    : optimistic update(ë‚™ê´€ì  ì—…ë°ì´íŠ¸ëŠ” ì•„ë˜ì— ì„¤ëª… ì°¸ê³ ) ì‚¬ìš© ì‹œ ìœ ìš©í•œ í•¨ìˆ˜ì´ë‹¤.
â–¶ onSuccess: (() => {})
    : mutation í•¨ìˆ˜ ì„±ê³µ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
â–¶ onError: (() => {})
    : mutation í•¨ìˆ˜ê°€ errorë¥¼ ë§Œë‚¬ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
â–¶ onSettled: (() => {})
    : mutation í•¨ìˆ˜ ì„±ê³µ í˜¹ì€ ì‹¤íŒ¨ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (ì„±ê³µì‹œ dataê°€ ì‹¤íŒ¨ì‹œ errorê°€ ì „ë‹¬ë  ë•Œ ì‹¤í–‰ëœë‹¤)
 

â—  ë‹¤ë§Œ, ë‘ ê³³ì—ì„œ ì¶”ê°€ ì½œë°±(onSuccess, onSettled, onError)ì„ ì‹¤í–‰í•  ê²½ìš°  useMutation ì˜ ì¶”ê°€ ì½œë°± -> mutate ì˜ ì¶”ê°€ ì½œë°±ìˆœìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. ë˜í•œ ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ë©´ ì¶”ê°€ ì½œë°±ì´ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë‹ˆ ì°¸ê³ í•˜ì.
staleTimeê³¼ cacheTimeì— ëŒ€í•˜ì—¬

React-queryëŠ” ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ìºì‹±í•˜ê³  ì‰½ê³  íš¨ìœ¨ì ì¸ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ì´ë¥¼ ì¡°ì ˆí•˜ê¸° ìœ„í•´ì„œ staleTimeê³¼ cacheTimeì„ ì¡°ì •í•  ê²ƒì´ë‹¤. 

 

ìœ„ì—ì„œ ì„¤ëª…í–ˆë“¯ì´ staleTimeì€ ìºì‹±í•œ ë°ì´í„°ê°€ freshí•œ ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ì‹œê°„ì´ë‹¤. staleTimeì„ 5ë¶„ìœ¼ë¡œ ì„¤ì •í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì. ì´ ìƒí™©ì—ì„œ ê¼­ ë°˜ë“œì‹œ 5ë¶„ì´ ì§€ë‚˜ì•¼ì§€ë§Œ ë°ì´í„°ë¥¼ ì¬í˜¸ì¶œ(refetch)í•  ìˆ˜ ìˆì„ê¹Œ?

 

ì •ë‹µì€ NO !

ë°ì´í„°ì˜ ì‹ ì„ ë„ë¥¼ ìœ„í•˜ì—¬(ë°±ì—”ë“œì™€ì˜ ìµœì‹ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë™ê¸°í™”) ì‹œê°„ì„ ì„¤ì •í•´ í¸ë¦¬í•¨ì„ ê°€ì§€ëŠ” ê²ƒì´ì§€ ë°˜ë“œì‹œ ì§€ì¼œì•¼í•˜ëŠ” ì‹œê°„ì€ ì•„ë‹ˆë‹¤. ì¦‰ ê°œë°œìê°€ ì›í•˜ëŠ” ì‹œì ì— ì¬í˜¸ì¶œí•˜ë„ë¡ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ë°ì´í„° ì¬í˜¸ì¶œì—ëŠ” 2ê°€ì§€ ë°©ë²•ì´ ëŒ€í‘œì ì´ë‹¤.

 

1. refetch()

refetch()ëŠ” useQueryë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë¦¬íŒ¨ì¹­í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ìºì‹±ëœ ë°ì´í„°ëŠ” ë¬´ì‹œí•˜ê³  ìƒˆë¡­ê²Œ ë°ì´í„°ë¥¼ ìš”ì²­í•œë‹¤. ì£¼ë¡œ ì‚¬ìš©ì actionì— ì˜í•œ ë°ì´í„° ê°±ì‹ ì´ í•„ìš”í•  ë•Œ ë§ì´ ì‚¬ìš©í•œë‹¤.

 

2. invalidate()

invalidate()ëŠ” ìºì‹±ëœ ë°ì´í„°ë¥¼ ë¬´íš¨í™”í•œ ë’¤ í•´ë‹¹ ìš”ì²­ì„ ë§Œë‚˜ê²Œ ë˜ë©´ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¤ëŠ” í˜•íƒœë¡œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. refetch()ì™€ì˜ ê°€ì¥ í° ì°¨ì´ì ì€ refetch()ëŠ” ìºì‹œë¥¼ ìœ ì§€í•˜ê³  ì´ë¥¼ ê°±ì‹ í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ë©°, invalidate()ëŠ” ìºì‹± ë°ì´í„°ë¥¼ ë¬´íš¨í™”í•˜ê³  ë°ì´í„°ë¥¼ ìƒˆë¡œ ë°›ì•„ì˜¤ëŠ” ì—­í• ì„ ë‹¤ìŒë²ˆì— ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ë°ì´í„°ë¥¼ ì¬ìš”ì²­í•  ë•Œ ì‚¬ìš©í•œë‹¤.

 

ì¦‰, invalidate()ëŠ” ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ì—¬ ìƒˆ ë°ì´í„°ë¥¼ ìš”ì²­í•  ì¤€ë¹„ë¥¼ í•˜ëŠ” ê²ƒì´ê³  refetch()ëŠ” ì‹¤ì œë¡œ ì¿¼ë¦¬ë¥¼ ì¬ì‹¤í–‰í•˜ì—¬ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì—­í• ì¸ ê²ƒì´ë‹¤.

const queryClient = useQueryClient();
const { data, refeth } = useQuery(['queryKey'], fetching, option);

const onClickRefetchBtn = () => {
  refeth();
};

const onClickInvalidateBtn = () => {
  queryClient.invalidateQueries('queryKey')
}

return (
  <>
    // 'queryKey' ì¿¼ë¦¬ë¥¼ ì¬ìš”ì²­í•˜ì—¬ ì—…ë°ì´íŠ¸
    <button onClick={onClickRefetchBtn}>REFETCHING</button>
    // 'queryKey' ì¿¼ë¦¬ì˜ ìºì‹±ëœ ë°ì´í„°ë¥¼ ë¬´íš¨í™”
    <button onClick={onClickInvalidateBtn}>INVALIDATING</button>
  </>
)
ë§Œì•½ ë°ì´í„°ê°€ ë³€ê²½ë˜ìë§ˆì ë°”ë¡œ ë°ì´í„°ë¥¼ ê°±ì‹ í•´ì•¼í•œë‹¤ë©´ refetch()ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. í•˜ì§€ë§Œ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ë‹¹ì¥ í•„ìš”í•œ ê²ƒì´ ì•„ë‹ˆë¼ë©´ invalidate()ë¥¼ í†µí•´ ë°ì´í„° ìºì‹±ì„ ë¹„ìš°ê³  í•„ìš”í•  ë•Œ ì¬ìš”ì²­í•˜ëŠ” ê²ƒì´ ë” ì¢‹ë‹¤.

Optimistic Update(ë‚™ê´€ì  ì—…ë°ì´íŠ¸)

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë€ ë°±ì—”ë“œ ë°ì´í„°ì™€ ì‚¬ìš© ì¤‘ì¸ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ëŠ” ê²ƒì„ ì‹ ê²½ì“°ì§€ ì•Šê³  ì‚¬ìš©ìì—ê²Œ ë¨¼ì € ë°ì´í„°ë¥¼ ë³´ì—¬ì¤€ í›„ ì„±ê³µ/ì‹¤íŒ¨ì— ë”°ë¼ UIë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ë‹¤.

 

ì¦‰, ì‚¬ìš©ìëŠ” ë°±ì—”ë“œì™€ì˜ í†µì‹  ì„±ê³µ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ UIë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ ì¸ìŠ¤íƒ€ê·¸ë¨ì˜ ì¢‹ì•„ìš”ë¥¼ ìƒê°í•˜ë©´ ëœë‹¤. ì•„ë˜ëŠ” ê³µì‹ ë¬¸ì„œì— ë‚˜ì™€ ìˆëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì‚¬ìš© ì˜ˆì‹œì´ë‹¤. í•µì‹¬ì€ onMutateë¥¼ í†µí•´ mutation í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ìƒíƒœ ì—…ë°ì´íŠ¸(í™”ë©´ì— ë°˜ì˜)ë¥¼ í•œ í›„ mutation í•¨ìˆ˜ì˜ ì„±ê³µ ì—¬ë¶€ë¥¼ ë°˜ì˜í•œ ìƒíƒœë¥¼ ë³´ì—¬ì¤€ë‹¤ëŠ” ê²ƒì´ë‹¤.

const queryClient = useQueryClient()
 
useMutation(updateTodo, {
  onMutate: async (newTodo) => {
    await queryClient.cancelQueries({ queryKey: ['todos'] })
 
    const previousTodos = queryClient.getQueryData(['todos'])
    queryClient.setQueryData(['todos'], (old) => [...old, newTodo])

    return { previousTodos }
  },

  onError: (err, newTodo, context) => {
    queryClient.setQueryData(['todos'], context.previousTodos)
  },

  onSettled: () => {
    queryClient.invalidateQueries({ queryKey: ['todos'] })
  },
})

https://juramemo.tistory.com/9